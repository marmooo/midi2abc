import tone2abc from"./midi2abc.js";function loadConfig(){localStorage.getItem("darkMode")==1&&(document.documentElement.dataset.theme="dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),delete document.documentElement.dataset.theme):(localStorage.setItem("darkMode",1),document.documentElement.dataset.theme="dark")}function dropFileEvent(a){a.preventDefault();const b=a.dataTransfer.files[0],c=new DataTransfer;c.items.add(b);const d=document.getElementById("inputFile");d.files=c.files,convertFromBlob(b)}function convertFileEvent(a){convertFromBlob(a.target.files[0])}function convertUrlEvent(a){convertFromUrl(a.target.value)}class CursorControl{constructor(a){this.root=a,this.cursor=this.initCursor(a)}initCursor(b){const a=document.createElementNS("http://www.w3.org/2000/svg","line");return a.setAttribute("class","abcjs-cursor"),a.setAttributeNS(null,"x1",0),a.setAttributeNS(null,"y1",0),a.setAttributeNS(null,"x2",0),a.setAttributeNS(null,"y2",0),b.appendChild(a),a}removeSelection(){const a=this.root.querySelectorAll(".abcjs-highlight");for(let b=0;b<a.length;b++)a[b].classList.remove("abcjs-highlight")}onStart(){}onEvent(a){if(a.measureStart&&a.left===null)return;this.removeSelection();for(let b=0;b<a.elements.length;b++){const c=a.elements[b];for(let a=0;a<c.length;a++)c[a].classList.add("abcjs-highlight")}this.cursor.setAttribute("x1",a.left-2),this.cursor.setAttribute("x2",a.left-2),this.cursor.setAttribute("y1",a.top),this.cursor.setAttribute("y2",a.top+a.height)}onFinished(){this.removeSelection(),this.cursor.setAttribute("x1",0),this.cursor.setAttribute("x2",0),this.cursor.setAttribute("y1",0),this.cursor.setAttribute("y2",0)}}function initScore(b){const c=document.getElementById("score"),d=document.getElementById("player"),e={responsive:"resize"},a=ABCJS.renderAbc("score",b,e),f=new CursorControl(c.querySelector("svg"));if(ABCJS.synth.supportsAudio()){const c={displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0,displayClock:!0},b=new ABCJS.synth.SynthController;b.load("#player",f,c);const d=new ABCJS.synth.CreateSynth;d.init({visualObj:a[0],options:{}}).then(()=>{b.setTune(a[0],!0).then(()=>{const a=document.querySelector(".abcjs-inline-audio");a.classList.remove("disabled")})})}else d.innerHTML=`
<div class="alert alert-warning">Audio is not supported on this browser.</div>
`}async function convertFromBlob(b){const d=await core.blobToNoteSequence(b),c=tone2abc(d,{title:b.name}),a=document.getElementById("abc");a.value=c,a.style.height=a.scrollHeight+4+"px",initScore(c)}async function convertFromUrl(b){const d=await core.urlToNoteSequence(b),c=tone2abc(d,{title:b.split("/").at(-1)}),a=document.getElementById("abc");a.value=c,a.style.height=a.scrollHeight+4+"px",initScore(c)}loadConfig(),convertFromUrl("cooleys.mid"),document.getElementById("toggleDarkMode").onclick=toggleDarkMode,document.ondragover=a=>{a.preventDefault()},document.ondrop=dropFileEvent,document.getElementById("inputFile").onchange=convertFileEvent,document.getElementById("inputUrl").onchange=convertUrlEvent